from re import fullmatch  # apparently match would mess up

with open("input.txt") as x:
    rules, lines = x.read().split("\n\n")
    rules, lines = [arr.split("\n") for arr in [rules, lines]]

ruld = {}
for r in rules:
    ruld[r.split(": ")[0]] = r.split(": ")[1]

finrul = {'33': 'a', '123': 'b', '7': '(ba|bb)', '60': '(aa)', '88': '(ab)', '46': '(b(aa)|a(ba|bb))', '84': '(aa|bb)', '52': '(ba)', '40': '((aa|bb)b|(aa)a)', '53': '(bb)', '9': '(ba|ab)', '36': '((ba|bb)a|(ba)b)', '105': '((ba|ab)b|(ba|bb)a)', '125': '((ba|bb)b|(ba|ab)a)', '43': '(b(ba|bb)|a(ab))', '12': '(a(ab)|b(bb))', '90': '((aa)b|(ba)a)', '63': '(bb|ab)', '5': '(a(bb)|b(bb|ab))', '111': '(aa|ba)', '74': '(ab|aa)', '56': '((aa|ba)a|(aa|bb)b)', '93': '((ba)a|(ba)b)', '122': '(a(ba|ab)|b(ba|bb))', '89': '(a|b)', '81': '(b(b(ba|bb)|a(ab))|a((aa|ba)a|(aa|bb)b))', '13': '(ba|(a|b)b)', '57': '(b(aa)|a(ba|ab))', '19': '(a(bb)|b(ba|bb))', '34': '(b(aa)|a(bb|ab))', '91': '(b(ba|ab)|a(ba|bb))', '47': '((ba)a|(aa|bb)b)', '109': '(b(a|b)|aa)', '58': '((ba|ab)a|(bb|ab)b)', '136': '(a(ab|aa)|b(b(a|b)|aa))', '17': '(b(b(ba|ab)|a(ba|bb))|a(a(ab|aa)|b(b(a|b)|aa)))', '116': '((a|b)(a|b))', '32': '(((a|b)(a|b))a|(bb)b)', '72': '((ba|ab)b|(aa|ba)a)', '70': '(a(ba|ab))', '18': '((aa|ba)a|(ab|aa)b)', '38': '((aa|ba)b|(ba)a)', '4': '(b(ba)|a(ba|bb))', '79': '((ba|(a|b)b)a|(aa|bb)b)', '6': '((ba|bb)a|((a|b)(a|b))b)', '98': '(((a|b)(a|b))(a|b))', '27': '((ab)a|(ba|ab)b)', '50': '(b(ab)|a(bb|ab))', '112': '((ab|aa)a|(aa)b)', '120': '((aa|ba)b|(aa|bb)a)', '128': '(a(a(ab)|b(bb))|b(a(bb)|b(bb|ab)))', '30': '((b(aa)|a(ba|ab))b|(((a|b)(a|b))(a|b))a)', '99': '(b((aa|ba)b|(aa|bb)a)|a((ba)a|(ba)b))', '117': '(b(bb|ab)|a(ba|bb))', '55': '(a(aa|ba))', '96': '(a((a|b)(a|b))|b(ba|bb))', '135': '(a(b(a|b)|aa)|b(aa|ba))', '126': '(((ab|aa)a|(aa)b)b|((ba|bb)a|(ba)b)a)', '97': '((aa|ba)a|(aa)b)', '24': '((ab|aa)a|(aa|bb)b)', '132': '(a(b(a|b)|aa)|b(bb))', '59': '(a(a|b)|bb)', '51': '(b((aa|bb)b|(aa)a)|a(b(ab)|a(bb|ab)))', '66': '(a(aa|ba)|b(ba))', '64': '((ba|(a|b)b)a|(ba|ab)b)', '15': '(a(ba|(a|b)b)|b(aa|ba))', '121': '(a((aa|ba)a|(aa)b)|b(a(bb)|b(ba|bb)))', '71': '(((a|b)(a|b))b|(bb)a)', '103': '((ba|(a|b)b)a|(bb|ab)b)', '129': '((a|b)a|ab)', '133': '(b(a(a|b)|bb)|a((a|b)a|ab))', '127': '(a(ab|aa)|b(a(a|b)|bb))', '73': '((aa|ba)a|((a|b)(a|b))b)', '92': '(((ba)a|(aa|bb)b)b|(b(ba|ab)|a(ba|bb))a)', '20': '(a(b(aa)|a(ba|bb))|b((ba|(a|b)b)a|(aa|bb)b))', '101': '(a((ab)a|(ba|ab)b)|b((aa|ba)a|(aa|bb)b))', '115': '(((a|b)(a|b))a|(ba|bb)b)', '41': '((b(aa)|a(ba|ab))a|(a(ab|aa)|b(a(a|b)|bb))b)', '106': '(a((ba|ab)b|(aa|ba)a)|b((ba|bb)a|((a|b)(a|b))b))', '104': '((((ba)a|(aa|bb)b)b|(b(ba|ab)|a(ba|bb))a)b|((b(aa)|a(ba|ab))a|(a(ab|aa)|b(a(a|b)|bb))b)a)', '77': '(b(ba|(a|b)b)|a((a|b)(a|b)))', '83': '(b((aa)b|(ba)a)|a(a(aa|ba)|b(ba)))', '25': '((a(a|b)|bb)b|(ba)a)', '86': '(a(a(ba|ab)|b(ba|bb))|b(a(aa|ba)))', '67': '(((ba|bb)a|((a|b)(a|b))b)b|((aa|ba)a|(ab|aa)b)a)', '78': '(b((ba|ab)a|(bb|ab)b)|a(a((a|b)(a|b))|b(ba|bb)))', '119': '(((ba|bb)b|(ba|ab)a)a|(b(ba|(a|b)b)|a((a|b)(a|b)))b)', '69': '(a(((a|b)(a|b))a|(bb)b)|b((ba|(a|b)b)a|(ba|ab)b))', '61': '(a(b(bb|ab)|a(ba|bb))|b((ba)a|(ba)b))', '62': '((a(ba|ab))b|(b(bb|ab)|a(ba|bb))a)', '113': '(a(b(a(a|b)|bb)|a((a|b)a|ab))|b(((a|b)(a|b))a|(ba|bb)b))', '44': '(a(a(ba|(a|b)b)|b(aa|ba))|b(a(aa|ba)))', '100': '(b(((ba|bb)a|((a|b)(a|b))b)b|((aa|ba)a|(ab|aa)b)a)|a(a((aa|ba)a|(aa)b)|b(a(bb)|b(ba|bb))))', '16': '(a((ab|aa)a|(aa|bb)b)|b((aa|ba)a|((a|b)(a|b))b))', '26': '((b(a|b)|aa)b|(a(a|b)|bb)a)', '65': '((a(a|b)|bb)a|(aa|bb)b)', '23': '((a((ba|ab)b|(aa|ba)a)|b((ba|bb)a|((a|b)(a|b))b))a|(((ab|aa)a|(aa)b)b|((ba|bb)a|(ba)b)a)b)', '82': '(a(b((aa|bb)b|(aa)a)|a(b(ab)|a(bb|ab)))|b(a(a(ab)|b(bb))|b(a(bb)|b(bb|ab))))', '87': '((ba)b|(a(a|b)|bb)a)', '37': '(a(a((ab)a|(ba|ab)b)|b((aa|ba)a|(aa|bb)b))|b(a((ab|aa)a|(aa|bb)b)|b((aa|ba)a|((a|b)(a|b))b)))', '2': '(b(a(b(a|b)|aa)|b(bb))|a((aa|ba)b|(ba)a))', '130': '((b(ba|ab)|a(ba|bb))a|((ba|(a|b)b)a|(bb|ab)b)b)', '124': '(a(((a|b)(a|b))a|(bb)b)|b(((a|b)(a|b))b|(bb)a))', '29': '(((b(aa)|a(ba|ab))b|(((a|b)(a|b))(a|b))a)a|((b(ba|ab)|a(ba|bb))a|((ba|(a|b)b)a|(bb|ab)b)b)b)', '45': '((b((aa|ba)b|(aa|bb)a)|a((ba)a|(ba)b))b|(((ba|bb)b|(ba|ab)a)a|(b(ba|(a|b)b)|a((a|b)(a|b)))b)a)', '94': '(a(ab)|b((a|b)a|ab))', '134': '((b((ba|ab)a|(bb|ab)b)|a(a((a|b)(a|b))|b(ba|bb)))b|(b((aa)b|(ba)a)|a(a(aa|ba)|b(ba)))a)', '108': '((a(((a|b)(a|b))a|(bb)b)|b(((a|b)(a|b))b|(bb)a))b|(a(a(ba|ab)|b(ba|bb))|b(a(aa|ba)))a)', '95': '(b((ba)b|(a(a|b)|bb)a)|a(a(b(a|b)|aa)|b(aa|ba)))', '107': '(b(b(ba)|a(ba|bb))|a((a(a|b)|bb)b|(ba)a))', '3': '(a(a(b((aa|bb)b|(aa)a)|a(b(ab)|a(bb|ab)))|b(a(a(ab)|b(bb))|b(a(bb)|b(bb|ab))))|b((b((aa|ba)b|(aa|bb)a)|a((ba)a|(ba)b))b|(((ba|bb)b|(ba|ab)a)a|(b(ba|(a|b)b)|a((a|b)(a|b)))b)a))', '102': '((b((ba)b|(a(a|b)|bb)a)|a(a(b(a|b)|aa)|b(aa|ba)))a|(b(b(ba|bb)|a(ab))|a((aa|ba)a|(aa|bb)b))b)', '54': '(a(a(a(ba|(a|b)b)|b(aa|ba))|b(a(aa|ba)))|b(b(a(b(a|b)|aa)|b(bb))|a((aa|ba)b|(ba)a)))', '1': '(a((b(a|b)|aa)b|(a(a|b)|bb)a)|b(b(aa)|a(bb|ab)))', '80': '(a(a(b(aa)|a(ba|bb))|b((ba|(a|b)b)a|(aa|bb)b))|b(a((b(a|b)|aa)b|(a(a|b)|bb)a)|b(b(aa)|a(bb|ab))))', '14': '(a((a(((a|b)(a|b))a|(bb)b)|b(((a|b)(a|b))b|(bb)a))b|(a(a(ba|ab)|b(ba|bb))|b(a(aa|ba)))a)|b(a(a((ab)a|(ba|ab)b)|b((aa|ba)a|(aa|bb)b))|b(a((ab|aa)a|(aa|bb)b)|b((aa|ba)a|((a|b)(a|b))b))))', '118': '((a(((a|b)(a|b))a|(bb)b)|b((ba|(a|b)b)a|(ba|ab)b))a|(b(b(ba)|a(ba|bb))|a((a(a|b)|bb)b|(ba)a))b)', '85': '(b((a(ba|ab))b|(b(bb|ab)|a(ba|bb))a)|a(b(b(ba|ab)|a(ba|bb))|a(a(ab|aa)|b(b(a|b)|aa))))', '49': '(b((ba)a|(aa|bb)b)|a((a(a|b)|bb)a|(aa|bb)b))', '76': '(a((a((ba|ab)b|(aa|ba)a)|b((ba|bb)a|((a|b)(a|b))b))a|(((ab|aa)a|(aa)b)b|((ba|bb)a|(ba)b)a)b)|b(b((a(ba|ab))b|(b(bb|ab)|a(ba|bb))a)|a(b(b(ba|ab)|a(ba|bb))|a(a(ab|aa)|b(b(a|b)|aa)))))', '110': '(((((ba)a|(aa|bb)b)b|(b(ba|ab)|a(ba|bb))a)b|((b(aa)|a(ba|ab))a|(a(ab|aa)|b(a(a|b)|bb))b)a)b|((b((ba)b|(a(a|b)|bb)a)|a(a(b(a|b)|aa)|b(aa|ba)))a|(b(b(ba|bb)|a(ab))|a((aa|ba)a|(aa|bb)b))b)a)', '48': '((a(ab)|b((a|b)a|ab))b|((ba|ab)b|(ba|bb)a)a)', '68': '((a(b(bb|ab)|a(ba|bb))|b((ba)a|(ba)b))a|(b((ba)a|(aa|bb)b)|a((a(a|b)|bb)a|(aa|bb)b))b)', '131': '((a(a(b(aa)|a(ba|bb))|b((ba|(a|b)b)a|(aa|bb)b))|b(a((b(a|b)|aa)b|(a(a|b)|bb)a)|b(b(aa)|a(bb|ab))))b|((b((ba|ab)a|(bb|ab)b)|a(a((a|b)(a|b))|b(ba|bb)))b|(b((aa)b|(ba)a)|a(a(aa|ba)|b(ba)))a)a)', '39': '(b(((b(aa)|a(ba|ab))b|(((a|b)(a|b))(a|b))a)a|((b(ba|ab)|a(ba|bb))a|((ba|(a|b)b)a|(bb|ab)b)b)b)|a((a(((a|b)(a|b))a|(bb)b)|b((ba|(a|b)b)a|(ba|ab)b))a|(b(b(ba)|a(ba|bb))|a((a(a|b)|bb)b|(ba)a))b))', '10': '((((((ba)a|(aa|bb)b)b|(b(ba|ab)|a(ba|bb))a)b|((b(aa)|a(ba|ab))a|(a(ab|aa)|b(a(a|b)|bb))b)a)b|((b((ba)b|(a(a|b)|bb)a)|a(a(b(a|b)|aa)|b(aa|ba)))a|(b(b(ba|bb)|a(ab))|a((aa|ba)a|(aa|bb)b))b)a)b|(a(a(b((aa|bb)b|(aa)a)|a(b(ab)|a(bb|ab)))|b(a(a(ab)|b(bb))|b(a(bb)|b(bb|ab))))|b((b((aa|ba)b|(aa|bb)a)|a((ba)a|(ba)b))b|(((ba|bb)b|(ba|ab)a)a|(b(ba|(a|b)b)|a((a|b)(a|b)))b)a))a)', '22': '(a(a(b(a(a|b)|bb)|a((a|b)a|ab))|b(((a|b)(a|b))a|(ba|bb)b))|b((a(ab)|b((a|b)a|ab))b|((ba|ab)b|(ba|bb)a)a))', '28': '((a(a(a(ba|(a|b)b)|b(aa|ba))|b(a(aa|ba)))|b(b(a(b(a|b)|aa)|b(bb))|a((aa|ba)b|(ba)a)))b|((a(b(bb|ab)|a(ba|bb))|b((ba)a|(ba)b))a|(b((ba)a|(aa|bb)b)|a((a(a|b)|bb)a|(aa|bb)b))b)a)', '35': '(b((a(a(b(aa)|a(ba|bb))|b((ba|(a|b)b)a|(aa|bb)b))|b(a((b(a|b)|aa)b|(a(a|b)|bb)a)|b(b(aa)|a(bb|ab))))b|((b((ba|ab)a|(bb|ab)b)|a(a((a|b)(a|b))|b(ba|bb)))b|(b((aa)b|(ba)a)|a(a(aa|ba)|b(ba)))a)a)|a(b(((b(aa)|a(ba|ab))b|(((a|b)(a|b))(a|b))a)a|((b(ba|ab)|a(ba|bb))a|((ba|(a|b)b)a|(bb|ab)b)b)b)|a((a(((a|b)(a|b))a|(bb)b)|b((ba|(a|b)b)a|(ba|ab)b))a|(b(b(ba)|a(ba|bb))|a((a(a|b)|bb)b|(ba)a))b)))', '75': '(b(a(a(b(a(a|b)|bb)|a((a|b)a|ab))|b(((a|b)(a|b))a|(ba|bb)b))|b((a(ab)|b((a|b)a|ab))b|((ba|ab)b|(ba|bb)a)a))|a(b(((ba|bb)a|((a|b)(a|b))b)b|((aa|ba)a|(ab|aa)b)a)|a(a((aa|ba)a|(aa)b)|b(a(bb)|b(ba|bb)))))', '21': '((a((a((ba|ab)b|(aa|ba)a)|b((ba|bb)a|((a|b)(a|b))b))a|(((ab|aa)a|(aa)b)b|((ba|bb)a|(ba)b)a)b)|b(b((a(ba|ab))b|(b(bb|ab)|a(ba|bb))a)|a(b(b(ba|ab)|a(ba|bb))|a(a(ab|aa)|b(b(a|b)|aa)))))b|((a(a(a(ba|(a|b)b)|b(aa|ba))|b(a(aa|ba)))|b(b(a(b(a|b)|aa)|b(bb))|a((aa|ba)b|(ba)a)))b|((a(b(bb|ab)|a(ba|bb))|b((ba)a|(ba)b))a|(b((ba)a|(aa|bb)b)|a((a(a|b)|bb)a|(aa|bb)b))b)a)a)', '42': '(a(b((a(a(b(aa)|a(ba|bb))|b((ba|(a|b)b)a|(aa|bb)b))|b(a((b(a|b)|aa)b|(a(a|b)|bb)a)|b(b(aa)|a(bb|ab))))b|((b((ba|ab)a|(bb|ab)b)|a(a((a|b)(a|b))|b(ba|bb)))b|(b((aa)b|(ba)a)|a(a(aa|ba)|b(ba)))a)a)|a(b(((b(aa)|a(ba|ab))b|(((a|b)(a|b))(a|b))a)a|((b(ba|ab)|a(ba|bb))a|((ba|(a|b)b)a|(bb|ab)b)b)b)|a((a(((a|b)(a|b))a|(bb)b)|b((ba|(a|b)b)a|(ba|ab)b))a|(b(b(ba)|a(ba|bb))|a((a(a|b)|bb)b|(ba)a))b)))|b((a((a((ba|ab)b|(aa|ba)a)|b((ba|bb)a|((a|b)(a|b))b))a|(((ab|aa)a|(aa)b)b|((ba|bb)a|(ba)b)a)b)|b(b((a(ba|ab))b|(b(bb|ab)|a(ba|bb))a)|a(b(b(ba|ab)|a(ba|bb))|a(a(ab|aa)|b(b(a|b)|aa)))))b|((a(a(a(ba|(a|b)b)|b(aa|ba))|b(a(aa|ba)))|b(b(a(b(a|b)|aa)|b(bb))|a((aa|ba)b|(ba)a)))b|((a(b(bb|ab)|a(ba|bb))|b((ba)a|(ba)b))a|(b((ba)a|(aa|bb)b)|a((a(a|b)|bb)a|(aa|bb)b))b)a)a))', '114': '((a((a(((a|b)(a|b))a|(bb)b)|b(((a|b)(a|b))b|(bb)a))b|(a(a(ba|ab)|b(ba|bb))|b(a(aa|ba)))a)|b(a(a((ab)a|(ba|ab)b)|b((aa|ba)a|(aa|bb)b))|b(a((ab|aa)a|(aa|bb)b)|b((aa|ba)a|((a|b)(a|b))b))))b|(b(a(a(b(a(a|b)|bb)|a((a|b)a|ab))|b(((a|b)(a|b))a|(ba|bb)b))|b((a(ab)|b((a|b)a|ab))b|((ba|ab)b|(ba|bb)a)a))|a(b(((ba|bb)a|((a|b)(a|b))b)b|((aa|ba)a|(ab|aa)b)a)|a(a((aa|ba)a|(aa)b)|b(a(bb)|b(ba|bb)))))a)', '8': '((a(b((a(a(b(aa)|a(ba|bb))|b((ba|(a|b)b)a|(aa|bb)b))|b(a((b(a|b)|aa)b|(a(a|b)|bb)a)|b(b(aa)|a(bb|ab))))b|((b((ba|ab)a|(bb|ab)b)|a(a((a|b)(a|b))|b(ba|bb)))b|(b((aa)b|(ba)a)|a(a(aa|ba)|b(ba)))a)a)|a(b(((b(aa)|a(ba|ab))b|(((a|b)(a|b))(a|b))a)a|((b(ba|ab)|a(ba|bb))a|((ba|(a|b)b)a|(bb|ab)b)b)b)|a((a(((a|b)(a|b))a|(bb)b)|b((ba|(a|b)b)a|(ba|ab)b))a|(b(b(ba)|a(ba|bb))|a((a(a|b)|bb)b|(ba)a))b)))|b((a((a((ba|ab)b|(aa|ba)a)|b((ba|bb)a|((a|b)(a|b))b))a|(((ab|aa)a|(aa)b)b|((ba|bb)a|(ba)b)a)b)|b(b((a(ba|ab))b|(b(bb|ab)|a(ba|bb))a)|a(b(b(ba|ab)|a(ba|bb))|a(a(ab|aa)|b(b(a|b)|aa)))))b|((a(a(a(ba|(a|b)b)|b(aa|ba))|b(a(aa|ba)))|b(b(a(b(a|b)|aa)|b(bb))|a((aa|ba)b|(ba)a)))b|((a(b(bb|ab)|a(ba|bb))|b((ba)a|(ba)b))a|(b((ba)a|(aa|bb)b)|a((a(a|b)|bb)a|(aa|bb)b))b)a)a)))', '31': '(b((a((a(((a|b)(a|b))a|(bb)b)|b(((a|b)(a|b))b|(bb)a))b|(a(a(ba|ab)|b(ba|bb))|b(a(aa|ba)))a)|b(a(a((ab)a|(ba|ab)b)|b((aa|ba)a|(aa|bb)b))|b(a((ab|aa)a|(aa|bb)b)|b((aa|ba)a|((a|b)(a|b))b))))b|(b(a(a(b(a(a|b)|bb)|a((a|b)a|ab))|b(((a|b)(a|b))a|(ba|bb)b))|b((a(ab)|b((a|b)a|ab))b|((ba|ab)b|(ba|bb)a)a))|a(b(((ba|bb)a|((a|b)(a|b))b)b|((aa|ba)a|(ab|aa)b)a)|a(a((aa|ba)a|(aa)b)|b(a(bb)|b(ba|bb)))))a)|a((((((ba)a|(aa|bb)b)b|(b(ba|ab)|a(ba|bb))a)b|((b(aa)|a(ba|ab))a|(a(ab|aa)|b(a(a|b)|bb))b)a)b|((b((ba)b|(a(a|b)|bb)a)|a(a(b(a|b)|aa)|b(aa|ba)))a|(b(b(ba|bb)|a(ab))|a((aa|ba)a|(aa|bb)b))b)a)b|(a(a(b((aa|bb)b|(aa)a)|a(b(ab)|a(bb|ab)))|b(a(a(ab)|b(bb))|b(a(bb)|b(bb|ab))))|b((b((aa|ba)b|(aa|bb)a)|a((ba)a|(ba)b))b|(((ba|bb)b|(ba|ab)a)a|(b(ba|(a|b)b)|a((a|b)(a|b)))b)a))a))', '11': '((a(b((a(a(b(aa)|a(ba|bb))|b((ba|(a|b)b)a|(aa|bb)b))|b(a((b(a|b)|aa)b|(a(a|b)|bb)a)|b(b(aa)|a(bb|ab))))b|((b((ba|ab)a|(bb|ab)b)|a(a((a|b)(a|b))|b(ba|bb)))b|(b((aa)b|(ba)a)|a(a(aa|ba)|b(ba)))a)a)|a(b(((b(aa)|a(ba|ab))b|(((a|b)(a|b))(a|b))a)a|((b(ba|ab)|a(ba|bb))a|((ba|(a|b)b)a|(bb|ab)b)b)b)|a((a(((a|b)(a|b))a|(bb)b)|b((ba|(a|b)b)a|(ba|ab)b))a|(b(b(ba)|a(ba|bb))|a((a(a|b)|bb)b|(ba)a))b)))|b((a((a((ba|ab)b|(aa|ba)a)|b((ba|bb)a|((a|b)(a|b))b))a|(((ab|aa)a|(aa)b)b|((ba|bb)a|(ba)b)a)b)|b(b((a(ba|ab))b|(b(bb|ab)|a(ba|bb))a)|a(b(b(ba|ab)|a(ba|bb))|a(a(ab|aa)|b(b(a|b)|aa)))))b|((a(a(a(ba|(a|b)b)|b(aa|ba))|b(a(aa|ba)))|b(b(a(b(a|b)|aa)|b(bb))|a((aa|ba)b|(ba)a)))b|((a(b(bb|ab)|a(ba|bb))|b((ba)a|(ba)b))a|(b((ba)a|(aa|bb)b)|a((a(a|b)|bb)a|(aa|bb)b))b)a)a))(b((a((a(((a|b)(a|b))a|(bb)b)|b(((a|b)(a|b))b|(bb)a))b|(a(a(ba|ab)|b(ba|bb))|b(a(aa|ba)))a)|b(a(a((ab)a|(ba|ab)b)|b((aa|ba)a|(aa|bb)b))|b(a((ab|aa)a|(aa|bb)b)|b((aa|ba)a|((a|b)(a|b))b))))b|(b(a(a(b(a(a|b)|bb)|a((a|b)a|ab))|b(((a|b)(a|b))a|(ba|bb)b))|b((a(ab)|b((a|b)a|ab))b|((ba|ab)b|(ba|bb)a)a))|a(b(((ba|bb)a|((a|b)(a|b))b)b|((aa|ba)a|(ab|aa)b)a)|a(a((aa|ba)a|(aa)b)|b(a(bb)|b(ba|bb)))))a)|a((((((ba)a|(aa|bb)b)b|(b(ba|ab)|a(ba|bb))a)b|((b(aa)|a(ba|ab))a|(a(ab|aa)|b(a(a|b)|bb))b)a)b|((b((ba)b|(a(a|b)|bb)a)|a(a(b(a|b)|aa)|b(aa|ba)))a|(b(b(ba|bb)|a(ab))|a((aa|ba)a|(aa|bb)b))b)a)b|(a(a(b((aa|bb)b|(aa)a)|a(b(ab)|a(bb|ab)))|b(a(a(ab)|b(bb))|b(a(bb)|b(bb|ab))))|b((b((aa|ba)b|(aa|bb)a)|a((ba)a|(ba)b))b|(((ba|bb)b|(ba|ab)a)a|(b(ba|(a|b)b)|a((a|b)(a|b)))b)a))a)))', '0': '(((a(b((a(a(b(aa)|a(ba|bb))|b((ba|(a|b)b)a|(aa|bb)b))|b(a((b(a|b)|aa)b|(a(a|b)|bb)a)|b(b(aa)|a(bb|ab))))b|((b((ba|ab)a|(bb|ab)b)|a(a((a|b)(a|b))|b(ba|bb)))b|(b((aa)b|(ba)a)|a(a(aa|ba)|b(ba)))a)a)|a(b(((b(aa)|a(ba|ab))b|(((a|b)(a|b))(a|b))a)a|((b(ba|ab)|a(ba|bb))a|((ba|(a|b)b)a|(bb|ab)b)b)b)|a((a(((a|b)(a|b))a|(bb)b)|b((ba|(a|b)b)a|(ba|ab)b))a|(b(b(ba)|a(ba|bb))|a((a(a|b)|bb)b|(ba)a))b)))|b((a((a((ba|ab)b|(aa|ba)a)|b((ba|bb)a|((a|b)(a|b))b))a|(((ab|aa)a|(aa)b)b|((ba|bb)a|(ba)b)a)b)|b(b((a(ba|ab))b|(b(bb|ab)|a(ba|bb))a)|a(b(b(ba|ab)|a(ba|bb))|a(a(ab|aa)|b(b(a|b)|aa)))))b|((a(a(a(ba|(a|b)b)|b(aa|ba))|b(a(aa|ba)))|b(b(a(b(a|b)|aa)|b(bb))|a((aa|ba)b|(ba)a)))b|((a(b(bb|ab)|a(ba|bb))|b((ba)a|(ba)b))a|(b((ba)a|(aa|bb)b)|a((a(a|b)|bb)a|(aa|bb)b))b)a)a)))((a(b((a(a(b(aa)|a(ba|bb))|b((ba|(a|b)b)a|(aa|bb)b))|b(a((b(a|b)|aa)b|(a(a|b)|bb)a)|b(b(aa)|a(bb|ab))))b|((b((ba|ab)a|(bb|ab)b)|a(a((a|b)(a|b))|b(ba|bb)))b|(b((aa)b|(ba)a)|a(a(aa|ba)|b(ba)))a)a)|a(b(((b(aa)|a(ba|ab))b|(((a|b)(a|b))(a|b))a)a|((b(ba|ab)|a(ba|bb))a|((ba|(a|b)b)a|(bb|ab)b)b)b)|a((a(((a|b)(a|b))a|(bb)b)|b((ba|(a|b)b)a|(ba|ab)b))a|(b(b(ba)|a(ba|bb))|a((a(a|b)|bb)b|(ba)a))b)))|b((a((a((ba|ab)b|(aa|ba)a)|b((ba|bb)a|((a|b)(a|b))b))a|(((ab|aa)a|(aa)b)b|((ba|bb)a|(ba)b)a)b)|b(b((a(ba|ab))b|(b(bb|ab)|a(ba|bb))a)|a(b(b(ba|ab)|a(ba|bb))|a(a(ab|aa)|b(b(a|b)|aa)))))b|((a(a(a(ba|(a|b)b)|b(aa|ba))|b(a(aa|ba)))|b(b(a(b(a|b)|aa)|b(bb))|a((aa|ba)b|(ba)a)))b|((a(b(bb|ab)|a(ba|bb))|b((ba)a|(ba)b))a|(b((ba)a|(aa|bb)b)|a((a(a|b)|bb)a|(aa|bb)b))b)a)a))(b((a((a(((a|b)(a|b))a|(bb)b)|b(((a|b)(a|b))b|(bb)a))b|(a(a(ba|ab)|b(ba|bb))|b(a(aa|ba)))a)|b(a(a((ab)a|(ba|ab)b)|b((aa|ba)a|(aa|bb)b))|b(a((ab|aa)a|(aa|bb)b)|b((aa|ba)a|((a|b)(a|b))b))))b|(b(a(a(b(a(a|b)|bb)|a((a|b)a|ab))|b(((a|b)(a|b))a|(ba|bb)b))|b((a(ab)|b((a|b)a|ab))b|((ba|ab)b|(ba|bb)a)a))|a(b(((ba|bb)a|((a|b)(a|b))b)b|((aa|ba)a|(ab|aa)b)a)|a(a((aa|ba)a|(aa)b)|b(a(bb)|b(ba|bb)))))a)|a((((((ba)a|(aa|bb)b)b|(b(ba|ab)|a(ba|bb))a)b|((b(aa)|a(ba|ab))a|(a(ab|aa)|b(a(a|b)|bb))b)a)b|((b((ba)b|(a(a|b)|bb)a)|a(a(b(a|b)|aa)|b(aa|ba)))a|(b(b(ba|bb)|a(ab))|a((aa|ba)a|(aa|bb)b))b)a)b|(a(a(b((aa|bb)b|(aa)a)|a(b(ab)|a(bb|ab)))|b(a(a(ab)|b(bb))|b(a(bb)|b(bb|ab))))|b((b((aa|ba)b|(aa|bb)a)|a((ba)a|(ba)b))b|(((ba|bb)b|(ba|ab)a)a|(b(ba|(a|b)b)|a((a|b)(a|b)))b)a))a))))'}
 
poss = []
new = True

ruld['8'] = '42 | 42 8' # didn't want to bother with making another file
ruld['11'] = '42 31 | 42 11 31'

while True: # until nothing new is found
    new = False
    for k, v in ruld.items():
        if v.startswith('"'):
            finrul[k] = v[1]
        else:
            vals = v.split(" ")
            lid = True
            for va in vals:
                if va == "|":
                    continue
                if va not in finrul.keys():
                    lid = False
            if lid:
                r = ""
                for va in vals:
                    if va != "|":
                        r = r + finrul[va]
                    else:
                        r += "|"
                finrul[k] = f"({r})"
    
    for l in lines:
        if fullmatch(finrul["0"], l) and l not in poss:
            poss.append(l)
            new = True

    if not new:
        print(len(poss))
        break

